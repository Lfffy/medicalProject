<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>医院管理 - 医疗数据分析系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- 浏�览器兼容性Polyfill -->
    <script src="static/js/polyfills.js"></script>
    <style>
        body {
            background: #f8f9fa;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        .hospital-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .hospital-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .hospital-header h2 {
            margin: 0;
            font-weight: bold;
        }
        
        .hospital-header .breadcrumb {
            background: none;
            margin: 10px 0 0 0;
            padding: 0;
        }
        
        .hospital-header .breadcrumb-item {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .hospital-header .breadcrumb-item.active {
            color: white;
        }
        
        .hospital-header .breadcrumb-item a {
            color: white;
            text-decoration: none;
        }
        
        .hospital-header .breadcrumb-item a:hover {
            text-decoration: underline;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .stat-card.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .stat-card.success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }
        
        .stat-card.warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: white;
        }
        
        .stat-card.info {
            background: linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%);
            color: white;
        }
        
        .stat-card .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            opacity: 0.9;
        }
        
        .stat-card .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-card .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .filter-bar {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }
        
        .filter-bar .form-control, .filter-bar .form-select {
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            padding: 12px 20px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .filter-bar .form-control:focus, .filter-bar .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(40, 167, 69, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 193, 7, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(220, 53, 69, 0.3);
        }
        
        .btn-outline-primary {
            border: 2px solid #667eea;
            color: #667eea;
            border-radius: 10px;
            padding: 12px 30px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-outline-primary:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #764ba2;
            color: white;
        }
        
        .hospital-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }
        
        .hospital-table table {
            margin: 0;
        }
        
        .hospital-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .hospital-table td {
            padding: 15px;
            vertical-align: middle;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .hospital-table tbody tr:hover {
            background: #f8f9fa;
        }
        
        .hospital-info {
            display: flex;
            align-items: center;
        }
        
        .hospital-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 15px;
        }
        
        .hospital-details h5 {
            margin: 0 0 5px 0;
            color: #333;
            font-weight: 600;
        }
        
        .hospital-details p {
            margin: 0;
            color: #666;
            font-size: 0.9rem;
        }
        
        .level-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            display: inline-block;
        }
        
        .level-badge.tertiary {
            background: #d4edda;
            color: #155724;
        }
        
        .level-badge.secondary {
            background: #cce5ff;
            color: #004085;
        }
        
        .level-badge.primary {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            display: inline-block;
        }
        
        .status-badge.active {
            background: #d4edda;
            color: #155724;
        }
        
        .status-badge.inactive {
            background: #f8d7da;
            color: #721c24;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .btn-sm {
            padding: 8px 15px;
            font-size: 0.875rem;
            border-radius: 8px;
        }
        
        .pagination {
            justify-content: center;
            margin-top: 30px;
        }
        
        .pagination .page-link {
            border: none;
            color: #667eea;
            padding: 10px 15px;
            margin: 0 5px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .pagination .page-link:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .pagination .page-item.active .page-link {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .empty-state i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 20px;
        }
        
        .empty-state h4 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .alert {
            border-radius: 10px;
            border: none;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .loading-spinner {
            display: none;
        }
        
        .btn.loading .btn-text {
            display: none;
        }
        
        .btn.loading .loading-spinner {
            display: inline-block;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }
        
        .chart-container h5 {
            margin-bottom: 20px;
            color: #333;
            font-weight: bold;
        }
        
        .nav-tabs {
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 30px;
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: #666;
            padding: 12px 20px;
            border-radius: 10px 10px 0 0;
            transition: all 0.3s ease;
            margin-right: 5px;
        }
        
        .nav-tabs .nav-link:hover {
            background: #f8f9fa;
            color: #667eea;
        }
        
        .nav-tabs .nav-link.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .tab-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }
    </style>
</head>
<body>
    <div class="hospital-container">
        <!-- 页面头部 -->
        <div class="hospital-header">
            <h2><i class="fas fa-hospital"></i> 医院管理</h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/index.html">首页</a></li>
                    <li class="breadcrumb-item"><a href="/admin.html">系统管理</a></li>
                    <li class="breadcrumb-item active">医院管理</li>
                </ol>
            </nav>
        </div>
        
        <!-- 统计卡片 -->
        <div class="stats-grid">
            <div class="stat-card primary">
                <div class="stat-icon"><i class="fas fa-hospital"></i></div>
                <div class="stat-value" id="totalHospitals">0</div>
                <div class="stat-label">医院总数</div>
            </div>
            <div class="stat-card success">
                <div class="stat-icon"><i class="fas fa-building"></i></div>
                <div class="stat-value" id="totalDepartments">0</div>
                <div class="stat-label">科室总数</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-icon"><i class="fas fa-user-md"></i></div>
                <div class="stat-value" id="totalDoctors">0</div>
                <div class="stat-label">医生总数</div>
            </div>
            <div class="stat-card info">
                <div class="stat-icon"><i class="fas fa-calendar-check"></i></div>
                <div class="stat-value" id="todaySchedules">0</div>
                <div class="stat-label">今日排班</div>
            </div>
        </div>
        
        <!-- 统计图表 -->
        <div class="row">
            <div class="col-md-6">
                <div class="chart-container">
                    <h5><i class="fas fa-chart-pie"></i> 医院等级分布</h5>
                    <canvas id="levelChart" width="400" height="200"></canvas>
                </div>
            </div>
            <div class="col-md-6">
                <div class="chart-container">
                    <h5><i class="fas fa-chart-bar"></i> 科室医生数量</h5>
                    <canvas id="departmentChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
        
        <!-- 标签页导航 -->
        <ul class="nav nav-tabs" id="hospitalTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="hospitals-tab" data-bs-toggle="tab" data-bs-target="#hospitals" type="button" role="tab">
                    <i class="fas fa-hospital"></i> 医院管理
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="departments-tab" data-bs-toggle="tab" data-bs-target="#departments" type="button" role="tab">
                    <i class="fas fa-building"></i> 科室管理
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="doctors-tab" data-bs-toggle="tab" data-bs-target="#doctors" type="button" role="tab">
                    <i class="fas fa-user-md"></i> 医生管理
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="schedules-tab" data-bs-toggle="tab" data-bs-target="#schedules" type="button" role="tab">
                    <i class="fas fa-calendar-alt"></i> 排班管理
                </button>
            </li>
        </ul>
        
        <!-- 标签页内容 -->
        <div class="tab-content" id="hospitalTabContent">
            <!-- 医院管理 -->
            <div class="tab-pane fade show active" id="hospitals" role="tabpanel">
                <!-- 筛选栏 -->
                <div class="filter-bar">
                    <div class="row g-3">
                        <div class="col-md-8">
                            <label for="hospitalSearch" class="form-label">搜索医院</label>
                            <input type="text" class="form-control" id="hospitalSearch" placeholder="搜索医院名称、地址或电话">
                        </div>
                        <div class="col-md-4 d-flex align-items-end">
                            <div class="btn-group w-100">
                                <button class="btn btn-primary" onclick="searchHospitals()">
                                    <i class="fas fa-search"></i> 搜索
                                </button>
                                <button class="btn btn-success" onclick="showAddHospitalModal()">
                                    <i class="fas fa-plus"></i> 添加医院
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 医院列表 -->
                <div class="hospital-table">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>医院信息</th>
                                <th>等级</th>
                                <th>科室数</th>
                                <th>医生数</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="hospitalTableBody">
                            <tr>
                                <td colspan="6" class="text-center">
                                    <i class="fas fa-spinner fa-spin"></i> 加载中...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- 分页 -->
                <nav aria-label="医院列表分页">
                    <ul class="pagination" id="hospitalPagination">
                        <!-- 分页按钮将通过JavaScript动态生成 -->
                    </ul>
                </nav>
            </div>
            
            <!-- 科室管理 -->
            <div class="tab-pane fade" id="departments" role="tabpanel">
                <!-- 筛选栏 -->
                <div class="filter-bar">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <label for="departmentHospital" class="form-label">所属医院</label>
                            <select class="form-select" id="departmentHospital">
                                <option value="">所有医院</option>
                            </select>
                        </div>
                        <div class="col-md-5">
                            <label for="departmentSearch" class="form-label">搜索科室</label>
                            <input type="text" class="form-control" id="departmentSearch" placeholder="搜索科室名称或描述">
                        </div>
                        <div class="col-md-4 d-flex align-items-end">
                            <div class="btn-group w-100">
                                <button class="btn btn-primary" onclick="searchDepartments()">
                                    <i class="fas fa-search"></i> 搜索
                                </button>
                                <button class="btn btn-success" onclick="showAddDepartmentModal()">
                                    <i class="fas fa-plus"></i> 添加科室
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 科室列表 -->
                <div class="hospital-table">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>科室信息</th>
                                <th>所属医院</th>
                                <th>医生数</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="departmentTableBody">
                            <tr>
                                <td colspan="5" class="text-center">
                                    <i class="fas fa-spinner fa-spin"></i> 加载中...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- 分页 -->
                <nav aria-label="科室列表分页">
                    <ul class="pagination" id="departmentPagination">
                        <!-- 分页按钮将通过JavaScript动态生成 -->
                    </ul>
                </nav>
            </div>
            
            <!-- 医生管理 -->
            <div class="tab-pane fade" id="doctors" role="tabpanel">
                <!-- 筛选栏 -->
                <div class="filter-bar">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <label for="doctorHospital" class="form-label">所属医院</label>
                            <select class="form-select" id="doctorHospital">
                                <option value="">所有医院</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="doctorDepartment" class="form-label">所属科室</label>
                            <select class="form-select" id="doctorDepartment">
                                <option value="">所有科室</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="doctorSearch" class="form-label">搜索医生</label>
                            <input type="text" class="form-control" id="doctorSearch" placeholder="搜索医生姓名、电话或邮箱">
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <div class="btn-group w-100">
                                <button class="btn btn-primary" onclick="searchDoctors()">
                                    <i class="fas fa-search"></i> 搜索
                                </button>
                                <button class="btn btn-success" onclick="showAddDoctorModal()">
                                    <i class="fas fa-plus"></i> 添加
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 医生列表 -->
                <div class="hospital-table">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>医生信息</th>
                                <th>职称</th>
                                <th>所属医院</th>
                                <th>所属科室</th>
                                <th>联系方式</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="doctorTableBody">
                            <tr>
                                <td colspan="7" class="text-center">
                                    <i class="fas fa-spinner fa-spin"></i> 加载中...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- 分页 -->
                <nav aria-label="医生列表分页">
                    <ul class="pagination" id="doctorPagination">
                        <!-- 分页按钮将通过JavaScript动态生成 -->
                    </ul>
                </nav>
            </div>
            
            <!-- 排班管理 -->
            <div class="tab-pane fade" id="schedules" role="tabpanel">
                <!-- 筛选栏 -->
                <div class="filter-bar">
                    <div class="row g-3">
                        <div class="col-md-2">
                            <label for="scheduleHospital" class="form-label">所属医院</label>
                            <select class="form-select" id="scheduleHospital">
                                <option value="">所有医院</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="scheduleDepartment" class="form-label">所属科室</label>
                            <select class="form-select" id="scheduleDepartment">
                                <option value="">所有科室</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="scheduleDoctor" class="form-label">医生</label>
                            <select class="form-select" id="scheduleDoctor">
                                <option value="">所有医生</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="startDate" class="form-label">开始日期</label>
                            <input type="date" class="form-control" id="startDate">
                        </div>
                        <div class="col-md-2">
                            <label for="endDate" class="form-label">结束日期</label>
                            <input type="date" class="form-control" id="endDate">
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <div class="btn-group w-100">
                                <button class="btn btn-primary" onclick="searchSchedules()">
                                    <i class="fas fa-search"></i> 搜索
                                </button>
                                <button class="btn btn-success" onclick="showAddScheduleModal()">
                                    <i class="fas fa-plus"></i> 添加
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 排班列表 -->
                <div class="hospital-table">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>医生信息</th>
                                <th>排班日期</th>
                                <th>时间段</th>
                                <th>班次类型</th>
                                <th>最大接诊数</th>
                                <th>所属医院</th>
                                <th>所属科室</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="scheduleTableBody">
                            <tr>
                                <td colspan="9" class="text-center">
                                    <i class="fas fa-spinner fa-spin"></i> 加载中...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- 分页 -->
                <nav aria-label="排班列表分页">
                    <ul class="pagination" id="schedulePagination">
                        <!-- 分页按钮将通过JavaScript动态生成 -->
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let currentHospitalPage = 1;
        let currentDepartmentPage = 1;
        let currentDoctorPage = 1;
        let currentSchedulePage = 1;
        let pageSize = 20;
        let totalHospitals = 0;
        let totalDepartments = 0;
        let totalDoctors = 0;
        let totalSchedules = 0;
        let levelChart = null;
        let departmentChart = null;
        
        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            loadHospitalStats();
            loadHospitalOptions();
            loadHospitals();
            
            // 设置默认日期范围（最近7天）
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(endDate.getDate() - 7);
            
            document.getElementById('startDate').value = startDate.toISOString().split('T')[0];
            document.getElementById('endDate').value = endDate.toISOString().split('T')[0];
            
            // 绑定事件监听器
            document.getElementById('departmentHospital').addEventListener('change', loadDepartments);
            document.getElementById('doctorHospital').addEventListener('change', function() {
                loadDepartmentOptions('doctorDepartment', this.value);
                loadDoctors();
            });
            document.getElementById('doctorDepartment').addEventListener('change', loadDoctors);
            document.getElementById('scheduleHospital').addEventListener('change', function() {
                loadDepartmentOptions('scheduleDepartment', this.value);
                loadDoctorOptions('scheduleDoctor', null, this.value);
                loadSchedules();
            });
            document.getElementById('scheduleDepartment').addEventListener('change', function() {
                loadDoctorOptions('scheduleDoctor', this.value, document.getElementById('scheduleHospital').value);
                loadSchedules();
            });
            document.getElementById('scheduleDoctor').addEventListener('change', loadSchedules);
        });
        
        // 检查登录状态
        function checkLoginStatus() {
            const userData = sessionStorage.getItem('currentUser');
            if (!userData) {
                window.location.href = '/login.html';
                return;
            }
            
            try {
                const user = JSON.parse(userData);
                if (user.role !== 'admin' && user.role !== 'manager') {
                    alert('您没有权限访问此页面');
                    window.location.href = '/index.html';
                    return;
                }
            } catch (e) {
                console.error('解析用户数据失败:', e);
                window.location.href = '/login.html';
            }
        }
        
        // 加载医院统计
        async function loadHospitalStats() {
            try {
                const response = await fetch('/api/hospitals/stats', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    const stats = result.data;
                    document.getElementById('totalHospitals').textContent = stats.total_hospitals || 0;
                    document.getElementById('totalDepartments').textContent = stats.total_departments || 0;
                    document.getElementById('totalDoctors').textContent = stats.total_doctors || 0;
                    document.getElementById('todaySchedules').textContent = stats.today_schedules || 0;
                    
                    renderLevelChart(stats.level_stats || []);
                    renderDepartmentChart(stats.department_stats || []);
                }
                
            } catch (error) {
                console.error('加载医院统计失败:', error);
            }
        }
        
        // 渲染医院等级分布图表
        function renderLevelChart(levelStats) {
            const ctx = document.getElementById('levelChart').getContext('2d');
            
            const labels = levelStats.map(item => getLevelDisplayName(item.level));
            const data = levelStats.map(item => item.count);
            
            if (levelChart) {
                levelChart.destroy();
            }
            
            levelChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(40, 167, 69, 0.8)',
                            'rgba(255, 193, 7, 0.8)'
                        ],
                        borderColor: [
                            'rgba(102, 126, 234, 1)',
                            'rgba(40, 167, 69, 1)',
                            'rgba(255, 193, 7, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        // 渲染科室医生数量图表
        function renderDepartmentChart(departmentStats) {
            const ctx = document.getElementById('departmentChart').getContext('2d');
            
            const labels = departmentStats.slice(0, 5).map(item => item.name);
            const data = departmentStats.slice(0, 5).map(item => item.doctor_count);
            
            if (departmentChart) {
                departmentChart.destroy();
            }
            
            departmentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '医生数量',
                        data: data,
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        // 加载医院选项
        async function loadHospitalOptions() {
            try {
                const response = await fetch('/api/hospitals?page=1&page_size=1000', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    const hospitals = result.data.hospitals || [];
                    const hospitalSelects = ['departmentHospital', 'doctorHospital', 'scheduleHospital'];
                    
                    hospitalSelects.forEach(selectId => {
                        const select = document.getElementById(selectId);
                        if (select) {
                            // 保留第一个选项
                            const firstOption = select.options[0];
                            select.innerHTML = '';
                            select.appendChild(firstOption);
                            
                            hospitals.forEach(hospital => {
                                const option = document.createElement('option');
                                option.value = hospital.id;
                                option.textContent = hospital.name;
                                select.appendChild(option);
                            });
                        }
                    });
                }
                
            } catch (error) {
                console.error('加载医院选项失败:', error);
            }
        }
        
        // 加载科室选项
        async function loadDepartmentOptions(selectId, hospitalId) {
            try {
                const params = new URLSearchParams({
                    page: 1,
                    page_size: 1000
                });
                
                if (hospitalId) {
                    params.append('hospital_id', hospitalId);
                }
                
                const response = await fetch(`/api/departments?${params}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    const departments = result.data.departments || [];
                    const select = document.getElementById(selectId);
                    
                    if (select) {
                        // 保留第一个选项
                        const firstOption = select.options[0];
                        select.innerHTML = '';
                        select.appendChild(firstOption);
                        
                        departments.forEach(department => {
                            const option = document.createElement('option');
                            option.value = department.id;
                            option.textContent = department.name;
                            select.appendChild(option);
                        });
                    }
                }
                
            } catch (error) {
                console.error('加载科室选项失败:', error);
            }
        }
        
        // 加载医生选项
        async function loadDoctorOptions(selectId, departmentId, hospitalId) {
            try {
                const params = new URLSearchParams({
                    page: 1,
                    page_size: 1000
                });
                
                if (hospitalId) {
                    params.append('hospital_id', hospitalId);
                }
                
                if (departmentId) {
                    params.append('department_id', departmentId);
                }
                
                const response = await fetch(`/api/doctors?${params}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    const doctors = result.data.doctors || [];
                    const select = document.getElementById(selectId);
                    
                    if (select) {
                        // 保留第一个选项
                        const firstOption = select.options[0];
                        select.innerHTML = '';
                        select.appendChild(firstOption);
                        
                        doctors.forEach(doctor => {
                            const option = document.createElement('option');
                            option.value = doctor.id;
                            option.textContent = `${doctor.name} (${doctor.title || '无职称'})`;
                            select.appendChild(option);
                        });
                    }
                }
                
            } catch (error) {
                console.error('加载医生选项失败:', error);
            }
        }
        
        // 加载医院列表
        async function loadHospitals(page = 1) {
            currentHospitalPage = page;
            
            const searchKeyword = document.getElementById('hospitalSearch').value.trim();
            
            const params = new URLSearchParams({
                page: currentHospitalPage,
                page_size: pageSize
            });
            
            if (searchKeyword) params.append('search', searchKeyword);
            
            try {
                const response = await fetch(`/api/hospitals?${params}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    const hospitals = result.data.hospitals || [];
                    totalHospitals = result.data.total || 0;
                    
                    renderHospitalTable(hospitals);
                    renderHospitalPagination();
                } else {
                    showAlert(result.message || '加载医院列表失败', 'danger');
                }
                
            } catch (error) {
                console.error('加载医院列表失败:', error);
                showAlert('网络错误，请稍后重试', 'danger');
            }
        }
        
        // 渲染医院表格
        function renderHospitalTable(hospitals) {
            const tbody = document.getElementById('hospitalTableBody');
            
            if (hospitals.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center">
                            <div class="empty-state">
                                <i class="fas fa-hospital"></i>
                                <h4>暂无医院数据</h4>
                                <p>请尝试调整搜索条件或添加新医院</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            hospitals.forEach(hospital => {
                html += `
                    <tr>
                        <td>
                            <div class="hospital-info">
                                <div class="hospital-icon">
                                    <i class="fas fa-hospital"></i>
                                </div>
                                <div class="hospital-details">
                                    <h5>${hospital.name}</h5>
                                    <p><i class="fas fa-map-marker-alt"></i> ${hospital.address}</p>
                                    <p><i class="fas fa-phone"></i> ${hospital.phone}</p>
                                </div>
                            </div>
                        </td>
                        <td>
                            <span class="level-badge ${hospital.level}">${getLevelDisplayName(hospital.level)}</span>
                        </td>
                        <td>
                            <span class="badge bg-info">${hospital.department_count || 0}</span>
                        </td>
                        <td>
                            <span class="badge bg-success">${hospital.doctor_count || 0}</span>
                        </td>
                        <td>
                            <span class="status-badge ${hospital.status}">${getStatusDisplayName(hospital.status)}</span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-outline-primary" onclick="viewHospitalDetail(${hospital.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-warning" onclick="editHospital(${hospital.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteHospital(${hospital.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }
        
        // 渲染医院分页
        function renderHospitalPagination() {
            const pagination = document.getElementById('hospitalPagination');
            const totalPages = Math.ceil(totalHospitals / pageSize);
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let html = '';
            
            // 上一页
            html += `
                <li class="page-item ${currentHospitalPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="loadHospitals(${currentHospitalPage - 1})">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
            `;
            
            // 页码
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentHospitalPage - 2 && i <= currentHospitalPage + 2)) {
                    html += `
                        <li class="page-item ${i === currentHospitalPage ? 'active' : ''}">
                            <a class="page-link" href="#" onclick="loadHospitals(${i})">${i}</a>
                        </li>
                    `;
                } else if (i === currentHospitalPage - 3 || i === currentHospitalPage + 3) {
                    html += `
                        <li class="page-item disabled">
                            <a class="page-link" href="#">...</a>
                        </li>
                    `;
                }
            }
            
            // 下一页
            html += `
                <li class="page-item ${currentHospitalPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="loadHospitals(${currentHospitalPage + 1})">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
            `;
            
            pagination.innerHTML = html;
        }
        
        // 搜索医院
        function searchHospitals() {
            loadHospitals(1);
        }
        
        // 加载科室列表
        async function loadDepartments(page = 1) {
            currentDepartmentPage = page;
            
            const hospitalId = document.getElementById('departmentHospital').value;
            const searchKeyword = document.getElementById('departmentSearch').value.trim();
            
            const params = new URLSearchParams({
                page: currentDepartmentPage,
                page_size: pageSize
            });
            
            if (hospitalId) params.append('hospital_id', hospitalId);
            if (searchKeyword) params.append('search', searchKeyword);
            
            try {
                const response = await fetch(`/api/departments?${params}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    const departments = result.data.departments || [];
                    totalDepartments = result.data.total || 0;
                    
                    renderDepartmentTable(departments);
                    renderDepartmentPagination();
                } else {
                    showAlert(result.message || '加载科室列表失败', 'danger');
                }
                
            } catch (error) {
                console.error('加载科室列表失败:', error);
                showAlert('网络错误，请稍后重试', 'danger');
            }
        }
        
        // 渲染科室表格
        function renderDepartmentTable(departments) {
            const tbody = document.getElementById('departmentTableBody');
            
            if (departments.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center">
                            <div class="empty-state">
                                <i class="fas fa-building"></i>
                                <h4>暂无科室数据</h4>
                                <p>请尝试调整搜索条件或添加新科室</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            departments.forEach(department => {
                html += `
                    <tr>
                        <td>
                            <div class="hospital-info">
                                <div class="hospital-icon">
                                    <i class="fas fa-building"></i>
                                </div>
                                <div class="hospital-details">
                                    <h5>${department.name}</h5>
                                    <p>${department.description || '暂无描述'}</p>
                                </div>
                            </div>
                        </td>
                        <td>${department.hospital_name || '-'}</td>
                        <td>
                            <span class="badge bg-info">${department.doctor_count || 0}</span>
                        </td>
                        <td>
                            <span class="status-badge ${department.status}">${getStatusDisplayName(department.status)}</span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-outline-warning" onclick="editDepartment(${department.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteDepartment(${department.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }
        
        // 渲染科室分页
        function renderDepartmentPagination() {
            const pagination = document.getElementById('departmentPagination');
            const totalPages = Math.ceil(totalDepartments / pageSize);
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let html = '';
            
            // 上一页
            html += `
                <li class="page-item ${currentDepartmentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="loadDepartments(${currentDepartmentPage - 1})">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
            `;
            
            // 页码
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentDepartmentPage - 2 && i <= currentDepartmentPage + 2)) {
                    html += `
                        <li class="page-item ${i === currentDepartmentPage ? 'active' : ''}">
                            <a class="page-link" href="#" onclick="loadDepartments(${i})">${i}</a>
                        </li>
                    `;
                } else if (i === currentDepartmentPage - 3 || i === currentDepartmentPage + 3) {
                    html += `
                        <li class="page-item disabled">
                            <a class="page-link" href="#">...</a>
                        </li>
                    `;
                }
            }
            
            // 下一页
            html += `
                <li class="page-item ${currentDepartmentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="loadDepartments(${currentDepartmentPage + 1})">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
            `;
            
            pagination.innerHTML = html;
        }
        
        // 搜索科室
        function searchDepartments() {
            loadDepartments(1);
        }
        
        // 加载医生列表
        async function loadDoctors(page = 1) {
            currentDoctorPage = page;
            
            const hospitalId = document.getElementById('doctorHospital').value;
            const departmentId = document.getElementById('doctorDepartment').value;
            const searchKeyword = document.getElementById('doctorSearch').value.trim();
            
            const params = new URLSearchParams({
                page: currentDoctorPage,
                page_size: pageSize
            });
            
            if (hospitalId) params.append('hospital_id', hospitalId);
            if (departmentId) params.append('department_id', departmentId);
            if (searchKeyword) params.append('search', searchKeyword);
            
            try {
                const response = await fetch(`/api/doctors?${params}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    const doctors = result.data.doctors || [];
                    totalDoctors = result.data.total || 0;
                    
                    renderDoctorTable(doctors);
                    renderDoctorPagination();
                } else {
                    showAlert(result.message || '加载医生列表失败', 'danger');
                }
                
            } catch (error) {
                console.error('加载医生列表失败:', error);
                showAlert('网络错误，请稍后重试', 'danger');
            }
        }
        
        // 渲染医生表格
        function renderDoctorTable(doctors) {
            const tbody = document.getElementById('doctorTableBody');
            
            if (doctors.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center">
                            <div class="empty-state">
                                <i class="fas fa-user-md"></i>
                                <h4>暂无医生数据</h4>
                                <p>请尝试调整搜索条件或添加新医生</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            doctors.forEach(doctor => {
                html += `
                    <tr>
                        <td>
                            <div class="hospital-info">
                                <div class="hospital-icon">
                                    <i class="fas fa-user-md"></i>
                                </div>
                                <div class="hospital-details">
                                    <h5>${doctor.name}</h5>
                                    <p>${doctor.specialization || '暂无专长'}</p>
                                </div>
                            </div>
                        </td>
                        <td>${doctor.title || '-'}</td>
                        <td>${doctor.hospital_name || '-'}</td>
                        <td>${doctor.department_name || '-'}</td>
                        <td>
                            <div><i class="fas fa-phone"></i> ${doctor.phone}</div>
                            <div><i class="fas fa-envelope"></i> ${doctor.email || '-'}</div>
                        </td>
                        <td>
                            <span class="status-badge ${doctor.status}">${getStatusDisplayName(doctor.status)}</span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-outline-warning" onclick="editDoctor(${doctor.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteDoctor(${doctor.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }
        
        // 渲染医生分页
        function renderDoctorPagination() {
            const pagination = document.getElementById('doctorPagination');
            const totalPages = Math.ceil(totalDoctors / pageSize);
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let html = '';
            
            // 上一页
            html += `
                <li class="page-item ${currentDoctorPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="loadDoctors(${currentDoctorPage - 1})">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
            `;
            
            // 页码
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentDoctorPage - 2 && i <= currentDoctorPage + 2)) {
                    html += `
                        <li class="page-item ${i === currentDoctorPage ? 'active' : ''}">
                            <a class="page-link" href="#" onclick="loadDoctors(${i})">${i}</a>
                        </li>
                    `;
                } else if (i === currentDoctorPage - 3 || i === currentDoctorPage + 3) {
                    html += `
                        <li class="page-item disabled">
                            <a class="page-link" href="#">...</a>
                        </li>
                    `;
                }
            }
            
            // 下一页
            html += `
                <li class="page-item ${currentDoctorPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="loadDoctors(${currentDoctorPage + 1})">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
            `;
            
            pagination.innerHTML = html;
        }
        
        // 搜索医生
        function searchDoctors() {
            loadDoctors(1);
        }
        
        // 加载排班列表
        async function loadSchedules(page = 1) {
            currentSchedulePage = page;
            
            const hospitalId = document.getElementById('scheduleHospital').value;
            const departmentId = document.getElementById('scheduleDepartment').value;
            const doctorId = document.getElementById('scheduleDoctor').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            const params = new URLSearchParams({
                page: currentSchedulePage,
                page_size: pageSize
            });
            
            if (hospitalId) params.append('hospital_id', hospitalId);
            if (departmentId) params.append('department_id', departmentId);
            if (doctorId) params.append('doctor_id', doctorId);
            if (startDate) params.append('start_date', startDate);
            if (endDate) params.append('end_date', endDate);
            
            try {
                const response = await fetch(`/api/schedules?${params}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    const schedules = result.data.schedules || [];
                    totalSchedules = result.data.total || 0;
                    
                    renderScheduleTable(schedules);
                    renderSchedulePagination();
                } else {
                    showAlert(result.message || '加载排班列表失败', 'danger');
                }
                
            } catch (error) {
                console.error('加载排班列表失败:', error);
                showAlert('网络错误，请稍后重试', 'danger');
            }
        }
        
        // 渲染排班表格
        function renderScheduleTable(schedules) {
            const tbody = document.getElementById('scheduleTableBody');
            
            if (schedules.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center">
                            <div class="empty-state">
                                <i class="fas fa-calendar-alt"></i>
                                <h4>暂无排班数据</h4>
                                <p>请尝试调整搜索条件或添加新排班</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            schedules.forEach(schedule => {
                html += `
                    <tr>
                        <td>
                            <div class="hospital-info">
                                <div class="hospital-icon">
                                    <i class="fas fa-user-md"></i>
                                </div>
                                <div class="hospital-details">
                                    <h5>${schedule.doctor_name}</h5>
                                    <p>${schedule.doctor_title || '无职称'}</p>
                                </div>
                            </div>
                        </td>
                        <td>${schedule.schedule_date}</td>
                        <td>${schedule.start_time} - ${schedule.end_time}</td>
                        <td>
                            <span class="badge bg-info">${getShiftTypeDisplayName(schedule.shift_type)}</span>
                        </td>
                        <td>
                            <span class="badge bg-success">${schedule.max_patients || 20}</span>
                        </td>
                        <td>${schedule.hospital_name || '-'}</td>
                        <td>${schedule.department_name || '-'}</td>
                        <td>
                            <span class="status-badge ${schedule.status}">${getStatusDisplayName(schedule.status)}</span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-outline-warning" onclick="editSchedule(${schedule.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteSchedule(${schedule.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }
        
        // 渲染排班分页
        function renderSchedulePagination() {
            const pagination = document.getElementById('schedulePagination');
            const totalPages = Math.ceil(totalSchedules / pageSize);
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let html = '';
            
            // 上一页
            html += `
                <li class="page-item ${currentSchedulePage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="loadSchedules(${currentSchedulePage - 1})">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
            `;
            
            // 页码
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentSchedulePage - 2 && i <= currentSchedulePage + 2)) {
                    html += `
                        <li class="page-item ${i === currentSchedulePage ? 'active' : ''}">
                            <a class="page-link" href="#" onclick="loadSchedules(${i})">${i}</a>
                        </li>
                    `;
                } else if (i === currentSchedulePage - 3 || i === currentSchedulePage + 3) {
                    html += `
                        <li class="page-item disabled">
                            <a class="page-link" href="#">...</a>
                        </li>
                    `;
                }
            }
            
            // 下一页
            html += `
                <li class="page-item ${currentSchedulePage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="loadSchedules(${currentSchedulePage + 1})">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
            `;
            
            pagination.innerHTML = html;
        }
        
        // 搜索排班
        function searchSchedules() {
            loadSchedules(1);
        }
        
        // 显示添加医院模态框
        function showAddHospitalModal() {
            const modalHtml = `
                <div class="modal fade" id="addHospitalModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">添加医院</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="addHospitalForm">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label for="hospitalName" class="form-label">医院名称 <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="hospitalName" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="hospitalLevel" class="form-label">医院等级 <span class="text-danger">*</span></label>
                                            <select class="form-select" id="hospitalLevel" required>
                                                <option value="">请选择等级</option>
                                                <option value="tertiary">三级医院</option>
                                                <option value="secondary">二级医院</option>
                                                <option value="primary">一级医院</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-6">
                                            <label for="hospitalPhone" class="form-label">联系电话 <span class="text-danger">*</span></label>
                                            <input type="tel" class="form-control" id="hospitalPhone" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="hospitalStatus" class="form-label">状态</label>
                                            <select class="form-select" id="hospitalStatus">
                                                <option value="active">启用</option>
                                                <option value="inactive">禁用</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <label for="hospitalAddress" class="form-label">医院地址 <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="hospitalAddress" required>
                                    </div>
                                    <div class="mt-3">
                                        <label for="hospitalDescription" class="form-label">医院描述</label>
                                        <textarea class="form-control" id="hospitalDescription" rows="3"></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">取消</button>
                                <button type="button" class="btn btn-primary" onclick="addHospital()">添加</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // 移除已存在的模态框
            const existingModal = document.getElementById('addHospitalModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // 添加新模态框
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // 显示模态框
            const modal = new bootstrap.Modal(document.getElementById('addHospitalModal'));
            modal.show();
            
            // 模态框关闭后移除DOM
            document.getElementById('addHospitalModal').addEventListener('hidden.bs.modal', function() {
                this.remove();
            });
        }
        
        // 添加医院
        async function addHospital() {
            const form = document.getElementById('addHospitalForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const hospitalData = {
                name: document.getElementById('hospitalName').value,
                level: document.getElementById('hospitalLevel').value,
                phone: document.getElementById('hospitalPhone').value,
                status: document.getElementById('hospitalStatus').value,
                address: document.getElementById('hospitalAddress').value,
                description: document.getElementById('hospitalDescription').value
            };
            
            try {
                const response = await fetch('/api/hospitals', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(hospitalData)
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    showAlert('医院添加成功', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('addHospitalModal')).hide();
                    loadHospitals();
                    loadHospitalStats();
                    loadHospitalOptions();
                } else {
                    showAlert(result.message || '添加医院失败', 'danger');
                }
                
            } catch (error) {
                console.error('添加医院失败:', error);
                showAlert('网络错误，请稍后重试', 'danger');
            }
        }
        
        // 查看医院详情
        async function viewHospitalDetail(hospitalId) {
            try {
                const response = await fetch(`/api/hospitals/${hospitalId}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    const data = result.data;
                    
                    const modalHtml = `
                        <div class="modal fade" id="hospitalDetailModal" tabindex="-1">
                            <div class="modal-dialog modal-xl">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">医院详情</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h6><i class="fas fa-hospital"></i> 基本信息</h6>
                                                <table class="table table-borderless">
                                                    <tr><td><strong>医院名称：</strong></td><td>${data.hospital.name}</td></tr>
                                                    <tr><td><strong>医院等级：</strong></td><td>${getLevelDisplayName(data.hospital.level)}</td></tr>
                                                    <tr><td><strong>联系电话：</strong></td><td>${data.hospital.phone}</td></tr>
                                                    <tr><td><strong>医院地址：</strong></td><td>${data.hospital.address}</td></tr>
                                                    <tr><td><strong>状态：</strong></td><td>${getStatusDisplayName(data.hospital.status)}</td></tr>
                                                    <tr><td><strong>创建时间：</strong></td><td>${data.hospital.created_at}</td></tr>
                                                </table>
                                            </div>
                                            <div class="col-md-6">
                                                <h6><i class="fas fa-info-circle"></i> 医院描述</h6>
                                                <p>${data.hospital.description || '暂无描述'}</p>
                                            </div>
                                        </div>
                                        <hr>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h6><i class="fas fa-building"></i> 科室信息 (${data.departments.length}个)</h6>
                                                <div style="max-height: 200px; overflow-y: auto;">
                                                    ${data.departments.length > 0 ? data.departments.map(dept => `
                                                        <div class="border-bottom pb-2 mb-2">
                                                            <strong>${dept.name}</strong>
                                                            <p class="mb-0 text-muted small">${dept.description || '暂无描述'}</p>
                                                        </div>
                                                    `).join('') : '<p class="text-muted">暂无科室</p>'}
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <h6><i class="fas fa-user-md"></i> 医生信息 (${data.doctors.length}名)</h6>
                                                <div style="max-height: 200px; overflow-y: auto;">
                                                    ${data.doctors.length > 0 ? data.doctors.map(doctor => `
                                                        <div class="border-bottom pb-2 mb-2">
                                                            <strong>${doctor.name}</strong> - ${doctor.title || '无职称'}
                                                            <p class="mb-0 text-muted small">${doctor.specialization || '暂无专长'}</p>
                                                        </div>
                                                    `).join('') : '<p class="text-muted">暂无医生</p>'}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">关闭</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // 移除已存在的模态框
                    const existingModal = document.getElementById('hospitalDetailModal');
                    if (existingModal) {
                        existingModal.remove();
                    }
                    
                    // 添加新模态框
                    document.body.insertAdjacentHTML('beforeend', modalHtml);
                    
                    // 显示模态框
                    const modal = new bootstrap.Modal(document.getElementById('hospitalDetailModal'));
                    modal.show();
                    
                    // 模态框关闭后移除DOM
                    document.getElementById('hospitalDetailModal').addEventListener('hidden.bs.modal', function() {
                        this.remove();
                    });
                    
                } else {
                    showAlert(result.message || '获取医院详情失败', 'danger');
                }
                
            } catch (error) {
                console.error('获取医院详情失败:', error);
                showAlert('网络错误，请稍后重试', 'danger');
            }
        }
        
        // 编辑医院
        function editHospital(hospitalId) {
            // 这里可以实现编辑医院的逻辑
            showAlert('编辑医院功能开发中...', 'info');
        }
        
        // 删除医院
        async function deleteHospital(hospitalId) {
            if (!confirm('确定要删除这个医院吗？此操作不可恢复。')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/hospitals/${hospitalId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    showAlert('医院删除成功', 'success');
                    loadHospitals();
                    loadHospitalStats();
                    loadHospitalOptions();
                } else {
                    showAlert(result.message || '删除医院失败', 'danger');
                }
                
            } catch (error) {
                console.error('删除医院失败:', error);
                showAlert('网络错误，请稍后重试', 'danger');
            }
        }
        
        // 显示添加科室模态框
        function showAddDepartmentModal() {
            const modalHtml = `
                <div class="modal fade" id="addDepartmentModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">添加科室</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="addDepartmentForm">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label for="departmentName" class="form-label">科室名称 <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="departmentName" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="departmentHospitalSelect" class="form-label">所属医院 <span class="text-danger">*</span></label>
                                            <select class="form-select" id="departmentHospitalSelect" required>
                                                <option value="">请选择医院</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-6">
                                            <label for="departmentStatus" class="form-label">状态</label>
                                            <select class="form-select" id="departmentStatus">
                                                <option value="active">启用</option>
                                                <option value="inactive">禁用</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <label for="departmentDescription" class="form-label">科室描述</label>
                                        <textarea class="form-control" id="departmentDescription" rows="3"></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">取消</button>
                                <button type="button" class="btn btn-primary" onclick="addDepartment()">添加</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // 移除已存在的模态框
            const existingModal = document.getElementById('addDepartmentModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // 添加新模态框
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // 填充医院选项
            const hospitalSelect = document.getElementById('departmentHospitalSelect');
            const originalHospitalSelect = document.getElementById('departmentHospital');
            for (let i = 1; i < originalHospitalSelect.options.length; i++) {
                const option = originalHospitalSelect.options[i].cloneNode(true);
                hospitalSelect.appendChild(option);
            }
            
            // 显示模态框
            const modal = new bootstrap.Modal(document.getElementById('addDepartmentModal'));
            modal.show();
            
            // 模态框关闭后移除DOM
            document.getElementById('addDepartmentModal').addEventListener('hidden.bs.modal', function() {
                this.remove();
            });
        }
        
        // 编辑科室
        function editDepartment(departmentId) {
            // 这里可以实现编辑科室的逻辑
            showAlert('编辑科室功能开发中...', 'info');
        }
        
        // 删除科室
        async function deleteDepartment(departmentId) {
            if (!confirm('确定要删除这个科室吗？此操作不可恢复。')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/departments/${departmentId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    showAlert('科室删除成功', 'success');
                    loadDepartments();
                    loadHospitalStats();
                } else {
                    showAlert(result.message || '删除科室失败', 'danger');
                }
                
            } catch (error) {
                console.error('删除科室失败:', error);
                showAlert('网络错误，请稍后重试', 'danger');
            }
        }
        
        // 显示添加医生模态框
        function showAddDoctorModal() {
            const modalHtml = `
                <div class="modal fade" id="addDoctorModal" tabindex="-1">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">添加医生</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="addDoctorForm">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <label for="doctorName" class="form-label">医生姓名 <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="doctorName" required>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="doctorTitle" class="form-label">职称</label>
                                            <input type="text" class="form-control" id="doctorTitle">
                                        </div>
                                        <div class="col-md-4">
                                            <label for="doctorGender" class="form-label">性别</label>
                                            <select class="form-select" id="doctorGender">
                                                <option value="male">男</option>
                                                <option value="female">女</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-4">
                                            <label for="doctorHospitalSelect" class="form-label">所属医院 <span class="text-danger">*</span></label>
                                            <select class="form-select" id="doctorHospitalSelect" required>
                                                <option value="">请选择医院</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="doctorDepartmentSelect" class="form-label">所属科室 <span class="text-danger">*</span></label>
                                            <select class="form-select" id="doctorDepartmentSelect" required>
                                                <option value="">请先选择医院</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="doctorStatus" class="form-label">状态</label>
                                            <select class="form-select" id="doctorStatus">
                                                <option value="active">启用</option>
                                                <option value="inactive">禁用</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-4">
                                            <label for="doctorPhone" class="form-label">联系电话 <span class="text-danger">*</span></label>
                                            <input type="tel" class="form-control" id="doctorPhone" required>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="doctorEmail" class="form-label">邮箱</label>
                                            <input type="email" class="form-control" id="doctorEmail">
                                        </div>
                                        <div class="col-md-4">
                                            <label for="doctorAge" class="form-label">年龄</label>
                                            <input type="number" class="form-control" id="doctorAge" min="18" max="100">
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <label for="doctorSpecialization" class="form-label">专业专长</label>
                                        <textarea class="form-control" id="doctorSpecialization" rows="2"></textarea>
                                    </div>
                                    <div class="mt-3">
                                        <label for="doctorBio" class="form-label">个人简介</label>
                                        <textarea class="form-control" id="doctorBio" rows="3"></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">取消</button>
                                <button type="button" class="btn btn-primary" onclick="addDoctor()">添加</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // 移除已存在的模态框
            const existingModal = document.getElementById('addDoctorModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // 添加新模态框
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // 填充医院选项
            const hospitalSelect = document.getElementById('doctorHospitalSelect');
            const originalHospitalSelect = document.getElementById('doctorHospital');
            for (let i = 1; i < originalHospitalSelect.options.length; i++) {
                const option = originalHospitalSelect.options[i].cloneNode(true);
                hospitalSelect.appendChild(option);
            }
            
            // 绑定医院选择事件
            document.getElementById('doctorHospitalSelect').addEventListener('change', async function() {
                const departmentSelect = document.getElementById('doctorDepartmentSelect');
                departmentSelect.innerHTML = '<option value="">请选择科室</option>';
                
                if (this.value) {
                    await loadDepartmentOptions('doctorDepartmentSelect', this.value);
                }
            });
            
            // 显示模态框
            const modal = new bootstrap.Modal(document.getElementById('addDoctorModal'));
            modal.show();
            
            // 模态框关闭后移除DOM
            document.getElementById('addDoctorModal').addEventListener('hidden.bs.modal', function() {
                this.remove();
            });
        }
        
        // 添加医生
        async function addDoctor() {
            const form = document.getElementById('addDoctorForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const doctorData = {
                name: document.getElementById('doctorName').value,
                title: document.getElementById('doctorTitle').value,
                gender: document.getElementById('doctorGender').value,
                hospital_id: document.getElementById('doctorHospitalSelect').value,
                department_id: document.getElementById('doctorDepartmentSelect').value,
                status: document.getElementById('doctorStatus').value,
                phone: document.getElementById('doctorPhone').value,
                email: document.getElementById('doctorEmail').value,
                age: document.getElementById('doctorAge').value,
                specialization: document.getElementById('doctorSpecialization').value,
                bio: document.getElementById('doctorBio').value
            };
            
            try {
                const response = await fetch('/api/doctors', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(doctorData)
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    showAlert('医生添加成功', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('addDoctorModal')).hide();
                    loadDoctors();
                    loadHospitalStats();
                } else {
                    showAlert(result.message || '添加医生失败', 'danger');
                }
                
            } catch (error) {
                console.error('添加医生失败:', error);
                showAlert('网络错误，请稍后重试', 'danger');
            }
        }
        
        // 编辑医生
        function editDoctor(doctorId) {
            // 这里可以实现编辑医生的逻辑
            showAlert('编辑医生功能开发中...', 'info');
        }
        
        // 删除医生
        async function deleteDoctor(doctorId) {
            if (!confirm('确定要删除这个医生吗？此操作不可恢复。')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/doctors/${doctorId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    showAlert('医生删除成功', 'success');
                    loadDoctors();
                    loadHospitalStats();
                } else {
                    showAlert(result.message || '删除医生失败', 'danger');
                }
                
            } catch (error) {
                console.error('删除医生失败:', error);
                showAlert('网络错误，请稍后重试', 'danger');
            }
        }
        
        // 显示添加排班模态框
        function showAddScheduleModal() {
            const modalHtml = `
                <div class="modal fade" id="addScheduleModal" tabindex="-1">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">添加排班</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="addScheduleForm">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <label for="scheduleHospitalSelect" class="form-label">所属医院 <span class="text-danger">*</span></label>
                                            <select class="form-select" id="scheduleHospitalSelect" required>
                                                <option value="">请选择医院</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="scheduleDepartmentSelect" class="form-label">所属科室 <span class="text-danger">*</span></label>
                                            <select class="form-select" id="scheduleDepartmentSelect" required>
                                                <option value="">请先选择医院</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="scheduleDoctorSelect" class="form-label">医生 <span class="text-danger">*</span></label>
                                            <select class="form-select" id="scheduleDoctorSelect" required>
                                                <option value="">请先选择科室</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="scheduleShiftType" class="form-label">班次类型 <span class="text-danger">*</span></label>
                                            <select class="form-select" id="scheduleShiftType" required>
                                                <option value="">请选择班次</option>
                                                <option value="morning">上午班</option>
                                                <option value="afternoon">下午班</option>
                                                <option value="evening">夜班</option>
                                                <option value="full_day">全天班</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-3">
                                            <label for="scheduleDate" class="form-label">排班日期 <span class="text-danger">*</span></label>
                                            <input type="date" class="form-control" id="scheduleDate" required>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="scheduleStartTime" class="form-label">开始时间 <span class="text-danger">*</span></label>
                                            <input type="time" class="form-control" id="scheduleStartTime" required>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="scheduleEndTime" class="form-label">结束时间 <span class="text-danger">*</span></label>
                                            <input type="time" class="form-control" id="scheduleEndTime" required>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="scheduleMaxPatients" class="form-label">最大接诊数</label>
                                            <input type="number" class="form-control" id="scheduleMaxPatients" value="20" min="1" max="100">
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-6">
                                            <label for="scheduleStatus" class="form-label">状态</label>
                                            <select class="form-select" id="scheduleStatus">
                                                <option value="active">启用</option>
                                                <option value="inactive">禁用</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <label for="scheduleNotes" class="form-label">备注</label>
                                        <textarea class="form-control" id="scheduleNotes" rows="2"></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">取消</button>
                                <button type="button" class="btn btn-primary" onclick="addSchedule()">添加</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // 移除已存在的模态框
            const existingModal = document.getElementById('addScheduleModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // 添加新模态框
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // 填充医院选项
            const hospitalSelect = document.getElementById('scheduleHospitalSelect');
            const originalHospitalSelect = document.getElementById('scheduleHospital');
            for (let i = 1; i < originalHospitalSelect.options.length; i++) {
                const option = originalHospitalSelect.options[i].cloneNode(true);
                hospitalSelect.appendChild(option);
            }
            
            // 绑定事件
            document.getElementById('scheduleHospitalSelect').addEventListener('change', async function() {
                const departmentSelect = document.getElementById('scheduleDepartmentSelect');
                const doctorSelect = document.getElementById('scheduleDoctorSelect');
                departmentSelect.innerHTML = '<option value="">请选择科室</option>';
                doctorSelect.innerHTML = '<option value="">请先选择科室</option>';
                
                if (this.value) {
                    await loadDepartmentOptions('scheduleDepartmentSelect', this.value);
                }
            });
            
            document.getElementById('scheduleDepartmentSelect').addEventListener('change', async function() {
                const doctorSelect = document.getElementById('scheduleDoctorSelect');
                doctorSelect.innerHTML = '<option value="">请选择医生</option>';
                
                if (this.value) {
                    const hospitalId = document.getElementById('scheduleHospitalSelect').value;
                    await loadDoctorOptions('scheduleDoctorSelect', this.value, hospitalId);
                }
            });
            
            // 设置默认日期为今天
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('scheduleDate').value = today;
            
            // 显示模态框
            const modal = new bootstrap.Modal(document.getElementById('addScheduleModal'));
            modal.show();
            
            // 模态框关闭后移除DOM
            document.getElementById('addScheduleModal').addEventListener('hidden.bs.modal', function() {
                this.remove();
            });
        }
        
        // 添加排班
        async function addSchedule() {
            const form = document.getElementById('addScheduleForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const scheduleData = {
                doctor_id: document.getElementById('scheduleDoctorSelect').value,
                schedule_date: document.getElementById('scheduleDate').value,
                start_time: document.getElementById('scheduleStartTime').value,
                end_time: document.getElementById('scheduleEndTime').value,
                shift_type: document.getElementById('scheduleShiftType').value,
                max_patients: document.getElementById('scheduleMaxPatients').value,
                status: document.getElementById('scheduleStatus').value,
                notes: document.getElementById('scheduleNotes').value
            };
            
            try {
                const response = await fetch('/api/schedules', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(scheduleData)
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    showAlert('排班添加成功', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('addScheduleModal')).hide();
                    loadSchedules();
                    loadHospitalStats();
                } else {
                    showAlert(result.message || '添加排班失败', 'danger');
                }
                
            } catch (error) {
                console.error('添加排班失败:', error);
                showAlert('网络错误，请稍后重试', 'danger');
            }
        }
        
        // 编辑排班
        function editSchedule(scheduleId) {
            // 这里可以实现编辑排班的逻辑
            showAlert('编辑排班功能开发中...', 'info');
        }
        
        // 删除排班
        async function deleteSchedule(scheduleId) {
            if (!confirm('确定要删除这个排班吗？此操作不可恢复。')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/schedules/${scheduleId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    showAlert('排班删除成功', 'success');
                    loadSchedules();
                    loadHospitalStats();
                } else {
                    showAlert(result.message || '删除排班失败', 'danger');
                }
                
            } catch (error) {
                console.error('删除排班失败:', error);
                showAlert('网络错误，请稍后重试', 'danger');
            }
        }
        
        // 添加科室
        async function addDepartment() {
            const form = document.getElementById('addDepartmentForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const departmentData = {
                name: document.getElementById('departmentName').value,
                hospital_id: document.getElementById('departmentHospitalSelect').value,
                status: document.getElementById('departmentStatus').value,
                description: document.getElementById('departmentDescription').value
            };
            
            try {
                const response = await fetch('/api/departments', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(departmentData)
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    showAlert('科室添加成功', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('addDepartmentModal')).hide();
                    loadDepartments();
                    loadHospitalStats();
                } else {
                    showAlert(result.message || '添加科室失败', 'danger');
                }
                
            } catch (error) {
                console.error('添加科室失败:', error);
                showAlert('网络错误，请稍后重试', 'danger');
            }
        }
        
        // 获取等级显示名称
        function getLevelDisplayName(level) {
            const levelMap = {
                'tertiary': '三级医院',
                'secondary': '二级医院',
                'primary': '一级医院'
            };
            return levelMap[level] || level;
        }
        
        // 获取状态显示名称
        function getStatusDisplayName(status) {
            const statusMap = {
                'active': '启用',
                'inactive': '禁用'
            };
            return statusMap[status] || status;
        }
        
        // 获取班次类型显示名称
        function getShiftTypeDisplayName(shiftType) {
            const shiftTypeMap = {
                'morning': '上午班',
                'afternoon': '下午班',
                'evening': '夜班',
                'full_day': '全天班'
            };
            return shiftTypeMap[shiftType] || shiftType;
        }
        
        // 显示提示信息
        function showAlert(message, type = 'info') {
            const alertHtml = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-circle' : 'info-circle'}"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            // 在页面顶部显示提示
            const container = document.querySelector('.hospital-container');
            container.insertAdjacentHTML('afterbegin', alertHtml);
            
            // 3秒后自动关闭
            setTimeout(() => {
                const alert = container.querySelector('.alert');
                if (alert) {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                }
            }, 3000);
        }
    </script>
</body>
</html>