# åŒ»ç–—ç–¾ç—…æ•°æ®åˆ†æå¤§å±å¯è§†åŒ–ç³»ç»Ÿ - æ•°æ®åº“å®Œæ•´æ–‡æ¡£

## ğŸ“Š æ•°æ®åº“æ¦‚è§ˆ

### åŸºæœ¬ä¿¡æ¯
- **æ•°æ®åº“åç§°**: medical_system.db
- **æ•°æ®åº“ç±»å‹**: SQLite
- **åˆ›å»ºæ—¶é—´**: 2025-06-18
- **æ€»è¡¨æ•°é‡**: 20å¼ è¡¨
- **æ•°æ®çŠ¶æ€**: âœ… å·²åˆå§‹åŒ–å¹¶åŒ…å«æµ‹è¯•æ•°æ®

---

## ğŸ—„ï¸ æ•°æ®åº“è¡¨ç»“æ„è¯¦ç»†è¯´æ˜

### 1. ğŸ‘¥ ç”¨æˆ·ç®¡ç†ç›¸å…³è¡¨

#### 1.1 users (ç”¨æˆ·è¡¨)
```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT UNIQUE NOT NULL,           -- ç”¨æˆ·å
    password TEXT NOT NULL,                  -- å¯†ç 
    email TEXT,                              -- é‚®ç®±
    role TEXT DEFAULT 'user',               -- è§’è‰² (admin/user)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```
**æ•°æ®è®°å½•**: 8æ¡
**ç”¨é€”**: ç³»ç»Ÿç”¨æˆ·è´¦æˆ·ç®¡ç†ï¼Œæ”¯æŒè§’è‰²æƒé™æ§åˆ¶

#### 1.2 permissions (æƒé™è¡¨)
```sql
CREATE TABLE permissions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    permission_name TEXT UNIQUE NOT NULL,    -- æƒé™åç§°
    description TEXT,                        -- æƒé™æè¿°
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```
**ç”¨é€”**: å®šä¹‰ç³»ç»Ÿå„ç§æ“ä½œæƒé™

#### 1.3 user_permissions (ç”¨æˆ·æƒé™å…³è”è¡¨)
```sql
CREATE TABLE user_permissions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER,                         -- ç”¨æˆ·ID
    permission_id INTEGER,                   -- æƒé™ID
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users (id),
    FOREIGN KEY (permission_id) REFERENCES permissions (id)
);
```
**ç”¨é€”**: ç”¨æˆ·ä¸æƒé™çš„å¤šå¯¹å¤šå…³è”å…³ç³»

---

### 2. ğŸ¥ åŒ»ç–—æœºæ„ç›¸å…³è¡¨

#### 2.1 hospitals (åŒ»é™¢è¡¨)
```sql
CREATE TABLE hospitals (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,                      -- åŒ»é™¢åç§°
    address TEXT,                             -- åŒ»é™¢åœ°å€
    phone TEXT,                              -- è”ç³»ç”µè¯
    level TEXT,                              -- åŒ»é™¢ç­‰çº§
    type TEXT,                               -- åŒ»é™¢ç±»å‹
    established_date DATE,                    -- å»ºé™¢æ—¥æœŸ
    description TEXT,                         -- åŒ»é™¢ç®€ä»‹
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```
**æ•°æ®è®°å½•**: 3æ¡
**ç”¨é€”**: å­˜å‚¨åŒ»é™¢åŸºæœ¬ä¿¡æ¯

#### 2.2 departments (ç§‘å®¤è¡¨)
```sql
CREATE TABLE departments (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    hospital_id INTEGER,                     -- æ‰€å±åŒ»é™¢ID
    name TEXT NOT NULL,                      -- ç§‘å®¤åç§°
    type TEXT,                               -- ç§‘å®¤ç±»å‹ (ä¸´åºŠ/åŒ»æŠ€/è¡Œæ”¿)
    description TEXT,                        -- ç§‘å®¤æè¿°
    phone TEXT,                              -- è”ç³»ç”µè¯
    location TEXT,                           -- ç§‘å®¤ä½ç½®
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (hospital_id) REFERENCES hospitals (id)
);
```
**æ•°æ®è®°å½•**: 9æ¡
**ç”¨é€”**: åŒ»é™¢ç§‘å®¤ä¿¡æ¯ç®¡ç†

---

### 3. ğŸ§‘â€âš•ï¸ æ‚£è€…ç›¸å…³è¡¨

#### 3.1 patients (æ‚£è€…è¡¨)
```sql
CREATE TABLE patients (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,                      -- æ‚£è€…å§“å
    gender TEXT,                             -- æ€§åˆ«
    age INTEGER,                             -- å¹´é¾„
    id_card TEXT,                            -- èº«ä»½è¯å·
    phone TEXT,                              -- è”ç³»ç”µè¯
    address TEXT,                            -- å®¶åº­ä½å€
    emergency_contact TEXT,                  -- ç´§æ€¥è”ç³»äºº
    emergency_phone TEXT,                    -- ç´§æ€¥è”ç³»ç”µè¯
    blood_type TEXT,                         -- è¡€å‹
    allergies TEXT,                          -- è¿‡æ•å²
    medical_history TEXT,                    -- ç—…å²
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```
**æ•°æ®è®°å½•**: 10æ¡
**ç”¨é€”**: æ‚£è€…åŸºæœ¬ä¿¡æ¯ç®¡ç†

#### 3.2 medical_records (åŒ»ç–—è®°å½•è¡¨)
```sql
CREATE TABLE medical_records (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    patient_id INTEGER,                      -- æ‚£è€…ID
    hospital_id INTEGER,                    -- åŒ»é™¢ID
    department_id INTEGER,                  -- ç§‘å®¤ID
    doctor_name TEXT,                        -- åŒ»ç”Ÿå§“å
    visit_date DATE,                         -- å°±è¯Šæ—¥æœŸ
    diagnosis TEXT,                          -- è¯Šæ–­ç»“æœ
    symptoms TEXT,                          -- ç—‡çŠ¶æè¿°
    treatment TEXT,                          -- æ²»ç–—æ–¹æ¡ˆ
    prescription TEXT,                       -- å¤„æ–¹ä¿¡æ¯
    notes TEXT,                              -- å¤‡æ³¨ä¿¡æ¯
    status TEXT,                             -- è®°å½•çŠ¶æ€
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (patient_id) REFERENCES patients (id),
    FOREIGN KEY (hospital_id) REFERENCES hospitals (id),
    FOREIGN KEY (department_id) REFERENCES departments (id)
);
```
**æ•°æ®è®°å½•**: 10æ¡
**ç”¨é€”**: æ‚£è€…å°±è¯Šè®°å½•ç®¡ç†

#### 3.3 vital_signs (ç”Ÿå‘½ä½“å¾è¡¨)
```sql
CREATE TABLE vital_signs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    patient_id INTEGER,                      -- æ‚£è€…ID
    record_date TIMESTAMP,                   -- è®°å½•æ—¶é—´
    systolic_pressure INTEGER,               -- æ”¶ç¼©å‹
    diastolic_pressure INTEGER,              -- èˆ’å¼ å‹
    heart_rate INTEGER,                      -- å¿ƒç‡
    body_temperature REAL,                   -- ä½“æ¸©
    respiratory_rate INTEGER,                -- å‘¼å¸é¢‘ç‡
    blood_sugar REAL,                        -- è¡€ç³–
    weight REAL,                             -- ä½“é‡
    height REAL,                             -- èº«é«˜
    bmi REAL,                                -- BMIæŒ‡æ•°
    oxygen_saturation REAL,                  -- è¡€æ°§é¥±å’Œåº¦
    notes TEXT,                              -- å¤‡æ³¨
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (patient_id) REFERENCES patients (id)
);
```
**æ•°æ®è®°å½•**: 9æ¡
**ç”¨é€”**: æ‚£è€…ç”Ÿå‘½ä½“å¾ç›‘æµ‹æ•°æ®

---

### 4. ğŸ¤° å­•äº§å¦‡ä¸“é¡¹ç®¡ç†è¡¨

#### 4.1 maternal_info (å­•äº§å¦‡ä¿¡æ¯è¡¨)
```sql
CREATE TABLE maternal_info (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,                      -- å­•å¦‡å§“å
    age INTEGER,                             -- å¹´é¾„
    gestational_weeks INTEGER,               -- å­•å‘¨
    pregnancy_count INTEGER,                 -- å­•æ¬¡
    parity INTEGER,                          -- äº§æ¬¡
    pregnancy_type TEXT,                      -- å¦Šå¨ ç±»å‹
    weight REAL,                             -- ä½“é‡
    height REAL,                             -- èº«é«˜
    systolic_pressure INTEGER,               -- æ”¶ç¼©å‹
    diastolic_pressure INTEGER,              -- èˆ’å¼ å‹
    fetal_heart_rate INTEGER,                -- èƒå¿ƒç‡
    due_date DATE,                           -- é¢„äº§æœŸ
    last_menstrual_date DATE,                -- æœ«æ¬¡æœˆç»
    risk_factors TEXT,                       -- é£é™©å› ç´ 
    notes TEXT,                              -- å¤‡æ³¨
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```
**æ•°æ®è®°å½•**: 2æ¡
**ç”¨é€”**: å­•äº§å¦‡ä¸“é¡¹å¥åº·ç®¡ç†

---

### 5. ğŸ“Š æ•°æ®åˆ†æç›¸å…³è¡¨

#### 5.1 medical_data (åŒ»ç–—æ•°æ®æ±‡æ€»è¡¨)
```sql
CREATE TABLE medical_data (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,                      -- æ‚£è€…å§“å
    gender TEXT,                             -- æ€§åˆ«
    age INTEGER,                             -- å¹´é¾„
    height REAL,                             -- èº«é«˜
    weight REAL,                             -- ä½“é‡
    systolic_pressure INTEGER,               -- æ”¶ç¼©å‹
    diastolic_pressure INTEGER,              -- èˆ’å¼ å‹
    heart_rate INTEGER,                      -- å¿ƒç‡
    blood_sugar REAL,                        -- è¡€ç³–
    disease_type TEXT,                       -- ç–¾ç—…ç±»å‹
    symptoms TEXT,                           -- ç—‡çŠ¶
    diagnosis TEXT,                          -- è¯Šæ–­
    treatment TEXT,                          -- æ²»ç–—
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```
**ç”¨é€”**: åŒ»ç–—æ•°æ®æ±‡æ€»ï¼Œç”¨äºç»Ÿè®¡åˆ†æ

#### 5.2 disease_analysis (ç–¾ç—…åˆ†æè¡¨)
```sql
CREATE TABLE disease_analysis (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    disease_name TEXT NOT NULL,              -- ç–¾ç—…åç§°
    disease_category TEXT,                   -- ç–¾ç—…åˆ†ç±»
    incidence_rate REAL,                     -- å‘ç—…ç‡
    mortality_rate REAL,                     -- æ­»äº¡ç‡
    age_group TEXT,                          -- å¹´é¾„ç»„
    gender_distribution TEXT,                -- æ€§åˆ«åˆ†å¸ƒ
    risk_factors TEXT,                       -- é£é™©å› ç´ 
    symptoms TEXT,                           -- ç—‡çŠ¶
    treatment_methods TEXT,                  -- æ²»ç–—æ–¹æ³•
    prevention_methods TEXT,                 -- é¢„é˜²æ–¹æ³•
    analysis_date DATE,                      -- åˆ†ææ—¥æœŸ
    data_source TEXT,                        -- æ•°æ®æ¥æº
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```
**ç”¨é€”**: ç–¾ç—…ç»Ÿè®¡åˆ†ææ•°æ®

#### 5.3 data_statistics (æ•°æ®ç»Ÿè®¡è¡¨)
```sql
CREATE TABLE data_statistics (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    stat_type TEXT NOT NULL,                 -- ç»Ÿè®¡ç±»å‹
    stat_date DATE NOT NULL,                 -- ç»Ÿè®¡æ—¥æœŸ
    total_patients INTEGER DEFAULT 0,        -- æ€»æ‚£è€…æ•°
    new_patients INTEGER DEFAULT 0,          -- æ–°å¢æ‚£è€…
    disease_counts TEXT,                      -- ç–¾ç—…ç»Ÿè®¡(JSON)
    department_stats TEXT,                    -- ç§‘å®¤ç»Ÿè®¡(JSON)
    age_distribution TEXT,                   -- å¹´é¾„åˆ†å¸ƒ(JSON)
    gender_distribution TEXT,                -- æ€§åˆ«åˆ†å¸ƒ(JSON)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```
**ç”¨é€”**: å„ç±»ç»Ÿè®¡æ•°æ®æ±‡æ€»

---

### 6. ğŸ“‹ ç³»ç»Ÿç®¡ç†è¡¨

#### 6.1 operation_logs (æ“ä½œæ—¥å¿—è¡¨)
```sql
CREATE TABLE operation_logs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER,                         -- æ“ä½œç”¨æˆ·ID
    operation_type TEXT NOT NULL,            -- æ“ä½œç±»å‹
    operation_detail TEXT,                   -- æ“ä½œè¯¦æƒ…
    ip_address TEXT,                         -- IPåœ°å€
    user_agent TEXT,                         -- ç”¨æˆ·ä»£ç†
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users (id)
);
```
**ç”¨é€”**: ç³»ç»Ÿæ“ä½œæ—¥å¿—è®°å½•

---

## ğŸ“ˆ æ•°æ®ç»Ÿè®¡æ±‡æ€»

### è¡¨æ•°æ®é‡ç»Ÿè®¡
| è¡¨å | è®°å½•æ•° | è¯´æ˜ |
|------|--------|------|
| users | 8 | ç³»ç»Ÿç”¨æˆ· |
| hospitals | 3 | åŒ»é™¢ä¿¡æ¯ |
| departments | 9 | ç§‘å®¤ä¿¡æ¯ |
| patients | 10 | æ‚£è€…ä¿¡æ¯ |
| medical_records | 10 | åŒ»ç–—è®°å½• |
| vital_signs | 9 | ç”Ÿå‘½ä½“å¾ |
| maternal_info | 2 | å­•äº§å¦‡ä¿¡æ¯ |
| permissions | å¾…ç»Ÿè®¡ | æƒé™å®šä¹‰ |
| user_permissions | å¾…ç»Ÿè®¡ | ç”¨æˆ·æƒé™å…³è” |
| operation_logs | å¾…ç»Ÿè®¡ | æ“ä½œæ—¥å¿— |

### æ•°æ®å…³ç³»å›¾
```
users â”€â”€â”¬â”€â”€ user_permissions â”€â”€â”¬â”€â”€ permissions
        â”‚                       â”‚
        â””â”€â”€ operation_logs       â”‚
                                â”‚
hospitals â”€â”€ departments â”€â”€ medical_records â”€â”€ patients
                                    â”‚               â”‚
                                    â””â”€â”€ vital_signs â”‚
                                                    â”‚
maternal_info â”€â”€ (ç‹¬ç«‹è¡¨ï¼Œå¯å…³è”patients)
```

---

## ğŸ” æ•°æ®æŸ¥è¯¢ç¤ºä¾‹

### 1. è·å–æ‚£è€…åŸºæœ¬ä¿¡æ¯åŠæœ€è¿‘ç”Ÿå‘½ä½“å¾
```sql
SELECT p.*, v.heart_rate, v.systolic_pressure, v.diastolic_pressure
FROM patients p
LEFT JOIN vital_signs v ON p.id = v.patient_id
WHERE p.id = 1
ORDER BY v.record_date DESC
LIMIT 1;
```

### 2. ç»Ÿè®¡å„ç§‘å®¤æ‚£è€…æ•°é‡
```sql
SELECT d.name as department_name, COUNT(mr.id) as patient_count
FROM departments d
LEFT JOIN medical_records mr ON d.id = mr.department_id
GROUP BY d.id, d.name
ORDER BY patient_count DESC;
```

### 3. å­•äº§å¦‡ç»Ÿè®¡åˆ†æ
```sql
SELECT 
    COUNT(*) as total_count,
    AVG(age) as avg_age,
    AVG(gestational_weeks) as avg_gestational_weeks,
    COUNT(CASE WHEN pregnancy_type = 'é«˜å±' THEN 1 END) as high_risk_count
FROM maternal_info;
```

---

## ğŸ› ï¸ æ•°æ®åº“ç»´æŠ¤

### å¤‡ä»½ç­–ç•¥
```sql
-- å¤‡ä»½æ•°æ®åº“
.backup medical_system_backup.db

-- æ¢å¤æ•°æ®åº“
.restore medical_system_backup.db
```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®
1. ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
2. å®šæœŸæ¸…ç†è¿‡æœŸçš„æ“ä½œæ—¥å¿—
3. å¯¹å¤§è¡¨è¿›è¡Œåˆ†åŒºå¤„ç†
4. å®šæœŸæ‰§è¡ŒVACUUMå‘½ä»¤ä¼˜åŒ–å­˜å‚¨

---

## ğŸ“ æ•°æ®å­—å…¸

### å­—æ®µç±»å‹è¯´æ˜
- **INTEGER**: æ•´æ•°ç±»å‹
- **TEXT**: æ–‡æœ¬ç±»å‹
- **REAL**: æµ®ç‚¹æ•°ç±»å‹
- **DATE**: æ—¥æœŸç±»å‹
- **TIMESTAMP**: æ—¶é—´æˆ³ç±»å‹

### çŠ¶æ€å€¼è¯´æ˜
- **role**: admin(ç®¡ç†å‘˜), user(æ™®é€šç”¨æˆ·)
- **gender**: ç”·, å¥³
- **pregnancy_type**: æ­£å¸¸, é«˜å±
- **status**: active(æ´»è·ƒ), inactive(éæ´»è·ƒ)

---

## ğŸ”„ æ•°æ®æ›´æ–°æ—¥å¿—

### ç‰ˆæœ¬ 1.0 (2025-06-18)
- âœ… åˆ›å»ºå®Œæ•´çš„æ•°æ®åº“ç»“æ„
- âœ… åˆå§‹åŒ–åŸºç¡€æµ‹è¯•æ•°æ®
- âœ… å»ºç«‹è¡¨é—´å…³è”å…³ç³»
- âœ… æ·»åŠ æ•°æ®å®Œæ•´æ€§çº¦æŸ

---

*æœ¬æ–‡æ¡£éšç³»ç»Ÿæ›´æ–°è€ŒæŒç»­ç»´æŠ¤*